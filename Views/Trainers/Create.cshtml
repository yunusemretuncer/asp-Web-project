@model AspWebProject.Models.ViewModels.TrainerEditViewModel

<h1 class="mb-4">Yeni Eğitmen Oluştur</h1>

<div class="card shadow-sm p-4">
    <form asp-action="Create" method="post">

        <!-- Full Name -->
        <div class="mb-3">
            <label asp-for="Trainer.FullName" class="form-label fw-bold"></label>
            <input asp-for="Trainer.FullName" class="form-control" placeholder="Eğitmen Adı" />
            <span asp-validation-for="Trainer.FullName" class="text-danger"></span>
        </div>

        <!-- Fitness Center -->
        <div class="mb-3">
            <label asp-for="Trainer.FitnessCenterId" class="form-label fw-bold">Fitness Center</label>
            <select asp-for="Trainer.FitnessCenterId" id="FitnessCenterId"
                    class="form-select" asp-items="ViewBag.FitnessCenterId">
                <option value="">Bir salon seçiniz</option>
            </select>
            <span asp-validation-for="Trainer.FitnessCenterId" class="text-danger"></span>
        </div>

        <!-- Services -->
        <h5 class="mt-4 mb-2 fw-bold">Verdiği Hizmetler</h5>

        <div id="services-area" class="p-3 bg-light border rounded">
            <p class="text-muted m-0">Salon seçiniz...</p>
        </div>

        <!-- Availability Schedule -->
        <h5 class="mt-4 mb-2 fw-bold">Çalışma Saatleri</h5>

        <div class="table-responsive">
            <table class="table table-bordered align-middle bg-white">
                <thead class="table-success text-center">
                    <tr>
                        <th>Gün</th>
                        <th>Müsait</th>
                        <th>Başlangıç</th>
                        <th>Bitiş</th>
                    </tr>
                </thead>
                <tbody>

                    @for (int i = 0; i < 5; i++)
                    {
                        var day = (DayOfWeek)(i + 1); // Monday–Friday

                        <tr>
                            <td class="fw-bold">@day</td>

                            <!-- Enabled Checkbox -->
                            <td class="text-center">
                                <input type="checkbox" class="form-check-input"
                                       name="Availabilities[@i].Enabled" />
                                <input type="hidden" name="Availabilities[@i].Day"
                                       value="@((int)day)" />
                            </td>

                            <!-- StartTime -->
                            <td>
                                <input type="time" name="Availabilities[@i].StartTime"
                                       class="form-control form-control-sm" />
                            </td>

                            <!-- EndTime -->
                            <td>
                                <input type="time" name="Availabilities[@i].EndTime"
                                       class="form-control form-control-sm" />
                            </td>
                        </tr>
                    }

                </tbody>
            </table>
        </div>

        <button type="submit" class="btn btn-success px-4 mt-3">
            <i class="bi bi-check-circle"></i> Kaydet
        </button>

    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        document.getElementById("FitnessCenterId").addEventListener("change", function () {

            const centerId = this.value;
            const area = document.getElementById("services-area");

            if (!centerId) {
                area.innerHTML = "<p class='text-muted'>Salon seçiniz...</p>";
                return;
            }

            fetch(`/Trainers/GetServicesByCenter?fitnessCenterId=${centerId}`)
                .then(res => res.json())
                .then(services => {

                    if (!services || services.length === 0) {
                        area.innerHTML = "<p class='text-muted'>Bu salonda hiç hizmet tanımlı değil.</p>";
                        return;
                    }

                    let html = `<div class="row">`;

                    services.forEach(s => {
                        html += `
                            <div class="col-md-4 mb-2">
                                <div class="form-check border rounded p-2 bg-white shadow-sm">
                                    <input class="form-check-input" type="checkbox"
                                        name="SelectedServiceIds" value="${s.id}">
                                    <label class="form-check-label">
                                        ${s.name}
                                    </label>
                                </div>
                            </div>`;
                    });

                    html += `</div>`;
                    area.innerHTML = html;
                });
        });
    </script>
}
