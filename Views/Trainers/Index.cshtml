@model IEnumerable<AspWebProject.Models.Trainer>

@{
    ViewData["Title"] = "Eğitmenler";
}

<h2 class="mb-4">Eğitmenler</h2>

<a asp-action="Create" class="btn btn-success mb-3">Yeni Eğitmen Ekle</a>

<!-- === Filtreleri Göster/Gizle Butonu === -->
<button id="ToggleFilters" class="btn btn-secondary mb-3">Filtreleri Göster</button>

<!-- === FILTRE PANELİ === -->
<div id="FilterPanel" style="display:none;" class="border rounded p-3 mb-4 bg-light shadow-sm">

    <div class="row g-3">

        <div class="col-md-4">
            <label class="fw-bold">Fitness Center</label>
            <select id="FilterCenter" class="form-control">
                <option value="">Hepsi</option>
                @foreach (var fc in ViewBag.FitnessCenters)
                {
                    <option value="@fc.Id">@fc.Name</option>
                }
            </select>
        </div>

        <div class="col-md-4">
            <label class="fw-bold">Çalışma Günü</label>
            <select id="FilterDay" class="form-control">
                <option value="">Hepsi</option>
                @foreach (DayOfWeek d in Enum.GetValues(typeof(DayOfWeek)))
                {
                    <option value="@((int)d)">@d</option>
                }
            </select>
        </div>

        <div class="col-md-4">
            <label class="fw-bold">Hizmet</label>
            <select id="FilterService" class="form-control">
                <option value="">Hepsi</option>
                @foreach (var s in ViewBag.Services)
                {
                    <option value="@s.Id">@s.Name</option>
                }
            </select>
        </div>

    </div>

    <button id="FilterBtn" class="btn btn-primary mt-3">Filtrele</button>

</div>

<!-- === EĞİTMEN TABLOSU === -->
<table class="table table-bordered table-striped shadow-sm">
    <thead class="table-success">
        <tr>
            <th>İsim</th>
            <th>Uzmanlık</th>
            <th>Salon</th>
            <th style="width:180px;">İşlemler</th>
        </tr>
    </thead>
    <tbody id="TrainerTableBody">
        <tr><td colspan="4">Veri yükleniyor...</td></tr>
    </tbody>
</table>


@section Scripts {
    <script>

        // === Filtre panelini aç/kapa ===
        $("#ToggleFilters").on("click", function () {
            $("#FilterPanel").toggle();
            $(this).text($("#FilterPanel").is(":visible")
                ? "Filtreleri Gizle"
                : "Filtreleri Göster");
        });

        // === FILTRELI SONUÇLARI GETİR ===
        function loadFiltered() {

            const query = {
                fitnessCenterId: $("#FilterCenter").val(),
                day: $("#FilterDay").val(),
                serviceId: $("#FilterService").val()
            };

            $("#TrainerTableBody").html("<tr><td colspan='4'>Yükleniyor...</td></tr>");

            $.get("/api/TrainersApi/filter", query, function (list) {

                if (!list || list.length === 0) {
                    $("#TrainerTableBody").html("<tr><td colspan='4'>Kayıt bulunamadı.</td></tr>");
                    return;
                }

                let html = "";

                list.forEach(t => {
                    html += `
                    <tr>
                        <td>${t.fullName}</td>
                        <td>${t.expertise}</td>
                        <td>${t.fitnessCenter}</td>
                                        <td class="text-end align-middle">

            <div class="btn-group" role="group">

                <a href="/Trainers/Edit/${t.id}"
                   class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-pencil-square"></i> Edit
                </a>

                <a href="/Trainers/Details/${t.id}"
                   class="btn btn-sm btn-outline-info">
                    <i class="bi bi-info-circle"></i> Details
                </a>

                <a href="/Trainers/Delete/${t.id}"
                   class="btn btn-sm btn-outline-danger">
                    <i class="bi bi-trash"></i> Delete
                </a>

            </div>

        </td>

                    </tr>
                    `;
                });

                $("#TrainerTableBody").html(html);
            });
        }

        // Sayfa açılır açılmaz yükle
        $(document).ready(loadFiltered);

        // Filtre butonları
        $("#FilterBtn").on("click", loadFiltered);
        $("#FilterCenter").on("change", loadFiltered);
        $("#FilterDay").on("change", loadFiltered);
        $("#FilterService").on("change", loadFiltered);

    </script>
}
